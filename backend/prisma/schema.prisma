// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int      @id @default(autoincrement())
  name          String
  email         String   @unique
  passwordHash  String   @map("password_hash")
  role          String   @default("EMPLOYEE")
  managerId     Int?     @map("manager_id")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  // Relations
  manager       User?     @relation("ManagerSubordinate", fields: [managerId], references: [id])
  subordinates  User[]    @relation("ManagerSubordinate")
  reviewerAssignments ReviewAssignment[] @relation("Reviewer")
  revieweeAssignments ReviewAssignment[] @relation("Reviewee")

  @@map("users")
}

model ReviewCycle {
  id          Int      @id @default(autoincrement())
  name        String
  startDate   DateTime @map("start_date")
  endDate     DateTime @map("end_date")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  assignments ReviewAssignment[]

  @@map("review_cycles")
}

model Category {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  questions   Question[]

  @@map("categories")
}

model Question {
  id         Int      @id @default(autoincrement())
  categoryId Int      @map("category_id")
  text       String
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  // Relations
  category   Category @relation(fields: [categoryId], references: [id])
  feedbacks  Feedback[]

  @@map("questions")
}

model ReviewAssignment {
  id            Int           @id @default(autoincrement())
  reviewCycleId Int           @map("review_cycle_id")
  reviewerId    Int           @map("reviewer_id")
  revieweeId    Int           @map("reviewee_id")
  relationType  String        @map("relation_type")
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")

  // Relations
  reviewCycle   ReviewCycle   @relation(fields: [reviewCycleId], references: [id])
  reviewer      User          @relation("Reviewer", fields: [reviewerId], references: [id])
  reviewee      User          @relation("Reviewee", fields: [revieweeId], references: [id])
  feedbacks     Feedback[]

  @@map("review_assignments")
}

model Feedback {
  id                  Int      @id @default(autoincrement())
  reviewAssignmentId  Int      @map("review_assignment_id")
  questionId          Int      @map("question_id")
  score               Int
  comment             String?
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  // Relations
  reviewAssignment    ReviewAssignment @relation(fields: [reviewAssignmentId], references: [id])
  question            Question         @relation(fields: [questionId], references: [id])

  @@map("feedbacks")
}

// Enums are not supported in SQLite, using String instead

